<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Getting Started - Ghidralib</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Getting Started";
        var mkdocs_page_input_path = "getting_started.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Ghidralib
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Ghidralib</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../compatibility/">Compatibility</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Getting Started</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#main-actors">Main actors</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#function">Function</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#instruction">Instruction</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#datatype">DataType</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#symbol">Symbol</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#working-at-various-abstraction-levels">Working at various abstraction levels</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#showcase">Showcase</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#emulation">Emulation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#graphs">Graphs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#path-finding">Path finding</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#conventions">Conventions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ide-configuration">IDE Configuration</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../reference/">API reference</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Ghidralib</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Getting Started</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="getting-started">Getting Started</h1>
<p>This document contains an introduction to the most important objects
wrapped by this library, and a few more motivational segments.</p>
<p>If you prefer to learn by example, check out the <a href="https://github.com/msm-code/ghidralib/tree/master/examples">examples directory</a>,
or the <a href="https://github.com/msm-code/ghidralib/blob/master/tests/ghidralib_test.py">tests</a>.
For a more complete reference, see the <a href="../reference/">API documentation</a>.</p>
<ul>
<li><a href="#main-actors">Main Actors</a> - description of the most important
ghidralib objects</li>
<li><a href="#working-at-various-abstraction-levels">Working at various abstraction levels</a>
description of the various abstraction levels wrapped (and made easy!)
by ghidralib.</li>
<li><a href="#conventions">Conventions</a> this library follows some design rules.
They are hopefully intuitive, but understanding them may make your
first steps easier.</li>
<li><a href="#ide-configuration">IDE configuration</a> I strongly recommend using
an IDE that supports type-checking.</li>
</ul>
<h2 id="installation">Installation</h2>
<p>To use ghidralib, <strong>just drop <a href="https://github.com/msm-code/ghidralib/blob/master/ghidralib.py">this file</a> into your ghidra_scripts directory</strong>.
Click <a href="https://raw.githubusercontent.com/msm-code/ghidralib/refs/heads/master/ghidralib.py">here</a>
for a direct download link.</p>
<h2 id="main-actors">Main actors</h2>
<p>A lot of objects are wrapped by this library. The most important at the beginning are:</p>
<ul>
<li><a href="#function">Function</a> - a function recognised by Ghidra</li>
<li><a href="#instruction">Instruction</a> - assembly instruction</li>
<li><a href="#datatype">DataType</a> - a configured data type</li>
<li><a href="#symbol">Symbol</a> - a named address (also called a label)</li>
</ul>
<h3 id="function">Function</h3>
<p>A function is a named block of code. Not all code in Ghidra belongs to a function,
but being in a function makes it easier to reason about - for example,
we can talk about parameters, variables, return values, etc.</p>
<p>Check these usage examples:</p>
<pre><code class="language-python">from ghidralib import *
# Get a function at address 0x8ca3f0
Function(0x8ca3f0)

# Get a function named &quot;main&quot;
Function(&quot;main&quot;)

# Print all assembly instructions in main function
for instr in Function(&quot;main&quot;).instructions:
    print(instr)

# Print all pcode instructions in main function
for instr in Function(&quot;main&quot;).pcode:
    print(instr)

# Print all high-level pcode instructions in main function
# Or you can do it in 100 lines of Java:
# https://github.com/evm-sec/high-pcode/blob/main/HighPCode.java
for instr in Function(&quot;main&quot;).high_pcode:
    print(instr)

# Print all basic blocks in main function
for block in Function(&quot;main&quot;).basicblocks:
    print(block)

# Print high variables in main function
# These are the variables as seen by decompiler - the ones
# that one thinks about when reversing
print(Function(&quot;main&quot;).high_variables)

# Get the control flow graph of the main function...
# ...and show it! (you can also do something more useful with it)
Function(&quot;main&quot;).control_flow.show()

# Decompile the main function and print the C code.
print(Function(&quot;main&quot;).decompile())

# Define a function at address 0x400300
Function.create(0x400300, &quot;main&quot;)

# Use symbolic execution to infer values of eax and edx at each call site
for call in Function(&quot;MyCustomCrypto&quot;).calls:
    ctx = call.infer_context()
    key, data = ctx[&quot;eax&quot;], ctx[&quot;edx&quot;]
    print(key, data)

# Infer parameters for each call to this function (using the decmopiler)
for call in Function(&quot;MyCustomCrypto&quot;).calls:
    key, data = call.get_args()
    print(key, data)

# Rename functions calling this function
for caller in Function(&quot;MyCustomCrypto&quot;).callers:
    # Use caller address as a suffix. It's often useful to combine this with
    # emulation, so you can put more context in the name.
    caller.rename(&quot;CallsCustomCrypto_{}&quot;.format(caller.address))

# Emulate a function call and pass parameters (using the function signature)
ctx = Function(&quot;GetFuncNameByHash&quot;).emulate(0x698766968)
print(ctx.read_cstring(ctx[&quot;eax&quot;]))

# Use Ghidra's SymbolicPropagator to get known register values
ctx = Function(0x401000).symbolic_context()
print(ctx.register_at(0x401020, &quot;eax&quot;))
</code></pre>
<p>Read more in the <a href="../reference/#ghidralib.Function"><code>Function</code> object documentation</a>.</p>
<h3 id="instruction">Instruction</h3>
<p>Instructions represent a single assembly operation.
They have a mnemonic (e.g. <code>mov</code>), operands (e.g. <code>eax, 3</code>),
and a pcode representation used for further analysis.</p>
<p>Check these usage examples:</p>
<pre><code class="language-python"># Get an instruction at address 0x8ca3f0
Instruction(0x8ca3f0)

# Get the first instruction in main function
Instruction(&quot;main&quot;)

# Print the instruction mnemonic and operands
instr = Instruction(0x8ca3f0)
print(instr.mnemonic, instr.operands)

# Print the instruction pcode:
for op in instr.pcode:
    print(op)

# Print the instruction high-level pcode:
for op in instr.high_pcode:
    print(op)
</code></pre>
<p>Read more in the <a href="../reference/#ghidralib.Instruction"><code>Instruction</code> object documentation</a>.</p>
<h3 id="datatype">DataType</h3>
<p>Data types are used to describe the structure of data in memory.</p>
<p>Check these usage examples:</p>
<pre><code class="language-python"># Get a datatype called &quot;int&quot;
DataType(&quot;int&quot;)

# Parse a datatype from C string
HINTERNET = DataType.from_c('typedef void* HINTERNET;')

# Change a datatype at location
create_data(0x1234, HINTERNET)

# You can also create structures from C code strings:
foo = DataType.from_c('struct foo { int a; int b; };')
</code></pre>
<p>Read more in the <a href="../reference/#ghidralib.DataType"><code>DataType</code> object documentation</a>.</p>
<h3 id="symbol">Symbol</h3>
<p>Sometimes called a label. Check these usage examples:</p>
<pre><code class="language-python"># Get a symbol (label) at address 0x8ca3f0
Symbol(0x8ca3f0)

# Get a symbol (label) named &quot;main&quot;
Symbol(&quot;main&quot;)

# Create a label &quot;foo&quot; at address 0x1234
Symbol.create(0x1234, &quot;foo&quot;)

# Change the symbol's data type
Symbol(&quot;DAT_1234&quot;).set_type(HINTERNET)

# Print all symbols in the program
for symbol in Symbol.all():
    print(symbol)

# Rename all unknown data to something funniner
for symbol in Symbol.all():
    if symbol.name.startswith(&quot;DAT_&quot;):
        symbol.rename(&quot;funniner_&quot; + symbol.name&quot;)
</code></pre>
<p>Read more in the <a href="../reference/#ghidralib.Symbol"><code>Symbol</code> object documentation</a>.</p>
<h2 id="working-at-various-abstraction-levels">Working at various abstraction levels</h2>
<p>In this section I'll briefly summarize ghidralib objects that you can use to
work at various abstraction levels.</p>
<ul>
<li>
<p><strong>Assembly instructions</strong> - at the lowest level, there is assembler.
You will use familiar <a href="../reference/#ghidralib.Instruction">Instruction</a>,
<a href="../reference/#ghidralib.BasicBlock">BasicBlock</a> and <a href="../reference/#ghidralib.Function">Function</a>.
When analysing data, you will think in terms of <a href="../reference/#ghidralib.Register">Register</a>s
of <a href="../reference/#ghidralib.Variable">Variables</a>, and references are in
terms of <a href="../reference/#ghidralib.Symbol">Symbols</a>.</p>
</li>
<li>
<p><strong>Pcode instructions</strong> - here you think in terms of <a href="../reference/#ghidralib.PcodeOp">PcodeOp</a>s,
and <a href="../reference/#ghidralib.PcodeBlock">PcodeBlocks</a>. You still work with
<a href="../reference/#ghidralib.Function">Functions</a>, but the data flows between
architecture-independent <a href="../reference/#ghidralib.Varnode">Varnodes</a> now instead.</p>
</li>
<li>
<p><strong>High Pcode instructions</strong> - after the decompilation, many things change.
You stil work with <a href="../reference/#ghidralib.PcodeOp">PcodeOps</a>, but they are
significantly transformed - referred as "High Pcode" in this library.
You now think in terms of <a href="../reference/#ghidralib.HighFunction">High Functions</a>,
<a href="../reference/#ghidralib.HighVariable">High Variables</a>, and
<a href="../reference/#ghidralib.HighSymbol">High Symbols</a>.
Even <a href="../reference/#ghidralib.Varnode">Varnodes</a> are now slightly more powerful
(under the hood they are <code>VarnodeASTs</code> now).</p>
</li>
<li>
<p><strong>Pcode syntax tree</strong> (<code>Function.pcode_tree</code>) -
As far as I know, there was no easy way to work with it. I hope ghidralib makes
this much easier. On
this level, you still have high <a href="../reference/#ghidralib.PcodeOp">PcodeOps</a>, but
syntactic elements like "dowhile" loops, "if" statements etc, are now recovered
and you can traverse the syntax tree (while still dealing with
<a href="../reference/#ghidralib.PcodeOp">PcodeOps</a>).</p>
</li>
<li>
<p>C abstract syntax tree (AST) - built internally by the decompiler, but not exported
by Ghidra. I hope to add support for it in ghidralib one way or another,
but for now there is no way to access it.</p>
</li>
<li>
<p><strong>Clang tokens</strong> (<code>Function.tokens</code>) - a stream of tokens that represent the C code.
It is very detailed, to the level that it contains even whitespace.
You can clean them up, but the data is still overprocessed a bit too much,
and not useful (IMO) during analysis. Ghidra uses it for display.</p>
</li>
</ul>
<h2 id="showcase">Showcase</h2>
<p>In this section I'll present a few examples of impressive-but-not-necessarily-useful
things you can do with ghidralib.</p>
<h3 id="emulation">Emulation</h3>
<p>Emulate the program from 0x400300 to 0x400400. When finished, read the value of <code>eax</code>
and the memory at 0x401000.</p>
<pre><code class="language-python"># Create a new emulator and execute code between 0x400300 and 0x400400
emu = Emulator()
emu.emulate(0x400300, 0x400400)
print(emu[&quot;eax&quot;])
print(emu.read_bytes(0x401000, 16))

# Emulate a function call and pass parameters (using the function signature)
ctx = Function(&quot;GetFuncNameByHash&quot;).emulate(0x698766968)
print(ctx.read_cstring(ctx[&quot;eax&quot;]))
</code></pre>
<p>In practice you can often use this for recovering obfuscated strings, or unpacking
simple packers.</p>
<h3 id="graphs">Graphs</h3>
<pre><code class="language-python"># Get the control flow graph of the main function (and display it)
Function(&quot;main&quot;).control_flow.show()
</code></pre>
<p>Graph visualisation is not the most useful feature of this library, but it
looks cool:</p>
<p><img alt="" src="../graph.png" /></p>
<p>And you can easily build the graph yourself:</p>
<pre><code class="language-python">g = Graph.create()
foo = g.vertex(&quot;foo&quot;)
bar = g.vertex(&quot;bar&quot;)
g.edge(foo, bar)
g.show()
</code></pre>
<p>Or you can do some actually useful things with included graph algorithms
(DFS, BFS, and topological sort) - like tracing paths between functions.</p>
<h3 id="path-finding">Path finding</h3>
<p>Find the shortest path from source to target in the program control flow graph.
If it exists, highlight all basic blocks along the way.</p>
<pre><code class="language-python">source, target = BasicBlock(&quot;entry&quot;), BasicBlock(0x00405073)
path = Program.control_flow().bfs(source)
while path.get(target):
    target.highlight()
    target = path[target]
</code></pre>
<p><img alt="" src="../bfs_highlight.png" /></p>
<p>You can highlight anything that has an address (like a basic block, function,
or a single instruction). Call .unhighlight() to clear the highlight.</p>
<h2 id="conventions">Conventions</h2>
<p>There are a few conventions that this library follows, and which may be useful
when learning:</p>
<ul>
<li>This library completely ignores the Ghidra "Address" abstraction. Plain integers
are used everywhere instead. Address abstraction is very powerful, but not
necessary for most use cases (at least my use cases).</li>
</ul>
<p>If this is a problem for you, please let me know - maybe there is a simple way
to make ghidralib work for you.</p>
<ul>
<li>Every object that wraps a Ghidra object has a <code>.raw</code> property that can be used
  to get the unwrapped object. So you can always "escape" ghidralib:</li>
</ul>
<pre><code class="language-python">Function(&quot;main&quot;).raw.UNKNOWN_STACK_DEPTH_CHANGE
2147483647
</code></pre>
<ul>
<li>Objects that have an address can be addressed in many different ways - by name,
  by address, or by Ghidra address object. All of these are equivalent:</li>
</ul>
<pre><code class="language-python">Function(&quot;main&quot;)
Function(0x669d1e)
Function(toAddr(0x669d1e))
</code></pre>
<ul>
<li>Additionaly, wrappers are "tolerant" and try to drop unnecessary layers.
  All of these are resolved to the same object:</li>
</ul>
<pre><code class="language-python">Instruction(getInstructionAt(toAddr(0x0669d2a)))  # from raw object
Instruction(0x669d2a)  # from integer
Instruction(Instruction(0x669d2a))  # wrapped two times
</code></pre>
<ul>
<li>Same goes in the other direction btw - Java API will accept wrappers</li>
</ul>
<pre><code class="language-python">getInstructionBefore(getInstructionAt(toAddr(0x0669d2a)))  # pure java
getInstructionBefore(Instruction(0x0669d2a))  # mixup library object
</code></pre>
<ul>
<li>
<p>Many objects expose a static constructor methods, where it makes sense.
  Possible methods are "get", "create", "all", "create". So for example
  instead of <code>getAllSymbols()</code> use <code>Symbols.all()</code>.</p>
</li>
<li>
<p>The difference between <code>Function.get(addr)</code> and <code>Function(addr)</code> is that
  <code>Function.get</code> returns <code>None</code> instead of raising an exception when
  the desired object was not found.</p>
</li>
</ul>
<h2 id="ide-configuration">IDE Configuration</h2>
<p>I strongly recommend using an IDE that supports type-checking. This is why:</p>
<p><img alt="" src="../typecheck.png" /></p>
<p>I personally use is VS Code with Python extensions. If you install
VsCode/VsCodium, a Python extension, and just drop ghidralib.py
in the ghidra_scripts directory, then everything should "just work".</p>
<p>If for some reason your script lives in a different directory than
ghidralib, override the PYTHONPATH so the typechecker knows how to
import it:</p>
<pre><code class="language-json">{
    &quot;python.analysis.extraPaths&quot;: [&quot;/home/you/Projects/ghidralib&quot;],
    &quot;terminal.integrated.env.windows&quot;: {
        &quot;PYTHONPATH&quot;: &quot;/home/you/Projects/ghidralib&quot;,
    }
}
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../compatibility/" class="btn btn-neutral float-left" title="Compatibility"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../reference/" class="btn btn-neutral float-right" title="API reference">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../compatibility/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../reference/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
